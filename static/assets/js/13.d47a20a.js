(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"1hyh":function(e,t,s){"use strict";s.r(t);var n=s("hk5r"),i=s.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){s.d(t,e,(function(){return n[e]}))}(a);t.default=i.a},RrDN:function(e,t,s){},Whvt:function(e,t,s){"use strict";s.r(t);var n=s("y2RD"),i=s("1hyh");for(var a in i)["default"].indexOf(a)<0&&function(e){s.d(t,e,(function(){return i[e]}))}(a);s("mcch");var o=s("KHd+"),r=Object(o.a)(i.default,n.a,n.b,!1,null,"4b643b53",null);t.default=r.exports},"b1K/":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,s,n,i){var a=sessionStorage.getItem("cursorIndex"),o=a&&JSON.parse(a);if(!e||!e.selectionStart&&0!==e.selectionStart||o.name!==t)return s+n;var r=o.start,l=o.end,c=e.scrollTop;return i.$nextTick((function(){e.selectionStart=r+n.length,e.selectionEnd=r+n.length,e.scrollTop=c,e.focus()})),s.substr(0,r)+n+s.substr(l)}},hk5r:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(s("PaSM")),i=r(s("b1K/")),a=s("CeR/"),o=r(s("0hVY"));function r(e){return e&&e.__esModule?e:{default:e}}t.default={name:"editorNotice",mixins:[n.default,o.default],props:{checkId:{type:String,default:""},noticeInfo:{type:Object,default:function(){return{}}},isShowFooter:{type:Boolean,default:!0},isShowTitle:{type:Boolean,default:!1},customRow:Number},data:function(){return{secondClick:!1,formInfo:{title:"",message:""},variableList:[],searchable:!0,insertVariable:{id:"",content:{},titleId:"",titleContent:{}},checkInfo:{title:!1,message:!1},rules:{}}},mounted:function(){this.initData(),this.rules.message=this.checkCommonRules("select").select,this.rules.title=this.checkCommonRules("select").select},methods:{initData:function(){this.formInfo.title=this.noticeInfo.title_template,this.formInfo.message=this.noticeInfo.content_template,this.getVariableList()},getVariableList:function(){var e=this;this.$store.dispatch("noticeConfigure/getVariableList").then((function(t){e.variableList=t.data})).catch((function(t){(0,a.errorHandler)(t,e)}))},submitNotice:function(){var e=this;if(this.hasPermission(["ticket_state_manage"])){if(this.$refs.wechatForm.validate().then((function(){}),(function(){})),!this.checkNotice()){var t={content_template:this.formInfo.message};"EMAIL"===this.checkId&&(t.title_template=this.formInfo.title);var s=this.noticeInfo.id;this.secondClick||(this.secondClick=!0,this.$store.dispatch("noticeConfigure/changeNotice",{params:t,id:s}).then((function(){e.$bkMessage({message:e.$t('m.deployPage["保存成功"]'),theme:"success"}),e.$parent.$parent.getNoticeList(),e.closeNotice()})).catch((function(t){(0,a.errorHandler)(t,e)})).finally((function(){e.secondClick=!1})))}}else this.applyForPermission(["ticket_state_manage"],this.$store.state.project.projectAuthActions,{})},closeNotice:function(){this.$emit("closeEditor")},checkNotice:function(){return this.checkInfo.title=!this.formInfo.title,this.checkInfo.message=!this.formInfo.message,this.checkInfo.title||this.checkInfo.message},changeInsert:function(){"message"===(arguments.length<=2?void 0:arguments[2])?this.formInfo.message=(0,i.default)(document.querySelector(".bk-editor-notice .bk-remindway-form .bk-form-textarea"),"editorNotice",this.formInfo.message,"${"+(arguments.length<=0?void 0:arguments[0])+"}",this):this.formInfo.title+="${"+(arguments.length<=0?void 0:arguments[0])+"}"}}}},mcch:function(e,t,s){"use strict";s("RrDN")},y2RD:function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"b",(function(){return i}));var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-editor-notice"},[t("bk-form",{key:e.checkId,ref:"wechatForm",attrs:{"label-width":150,model:e.formInfo,"form-type":"vertical",rules:e.rules}},["WEIXIN"===e.checkId?[e.isShowTitle?t("bk-form-item",{attrs:{label:e.$t("m.slaContent['标题']"),required:!0,property:"title","icon-offset":240}},[t("bk-input",{attrs:{type:"text","ext-cls":"bk-remindway-form"},model:{value:e.formInfo.title,callback:function(t){e.$set(e.formInfo,"title",t)},expression:"formInfo.title"}}),e._v(" "),t("div",{staticClass:"bk-select-btn"},[t("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:e.$t("m.slaContent['插入变量']"),icon:"plus"}},[e._v("\n            "+e._s(e.$t('m.slaContent["插入变量"]'))+"\n          ")]),e._v(" "),t("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(t){return e.changeInsert(...arguments,"title")}},model:{value:e.insertVariable.titleId,callback:function(t){e.$set(e.insertVariable,"titleId",t)},expression:"insertVariable.titleId"}},e._l(e.variableList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1)],1):e._e(),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.slaContent['提醒内容']"),required:!0,property:"message","icon-offset":240}},[t("bk-input",{directives:[{name:"cursorIndex",rawName:"v-cursorIndex",value:"editorNotice",expression:"'editorNotice'"}],attrs:{type:"textarea","ext-cls":"bk-remindway-form",rows:e.customRow||5},model:{value:e.formInfo.message,callback:function(t){e.$set(e.formInfo,"message",t)},expression:"formInfo.message"}}),e._v(" "),t("div",{staticClass:"bk-select-btn"},[t("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:e.$t("m.slaContent['插入变量']"),icon:"plus"}},[e._v("\n            "+e._s(e.$t('m.slaContent["插入变量"]'))+"\n          ")]),e._v(" "),t("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(t){return e.changeInsert(...arguments,"message")}},model:{value:e.insertVariable.id,callback:function(t){e.$set(e.insertVariable,"id",t)},expression:"insertVariable.id"}},e._l(e.variableList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1)],1)]:"EMAIL"===e.checkId?[t("bk-form-item",{attrs:{label:e.$t("m.slaContent['标题']"),required:!0,property:"title","icon-offset":240}},[t("bk-input",{attrs:{type:"text","ext-cls":"bk-remindway-form"},model:{value:e.formInfo.title,callback:function(t){e.$set(e.formInfo,"title",t)},expression:"formInfo.title"}}),e._v(" "),t("div",{staticClass:"bk-select-btn"},[t("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:e.$t("m.slaContent['插入变量']"),icon:"plus"}},[e._v("\n            "+e._s(e.$t('m.slaContent["插入变量"]'))+"\n          ")]),e._v(" "),t("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(t){return e.changeInsert(...arguments,"title")}},model:{value:e.insertVariable.titleId,callback:function(t){e.$set(e.insertVariable,"titleId",t)},expression:"insertVariable.titleId"}},e._l(e.variableList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1)],1),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.slaContent['邮件内容']"),required:!0,property:"message","icon-offset":240}},[t("bk-input",{directives:[{name:"cursorIndex",rawName:"v-cursorIndex",value:"editorNotice",expression:"'editorNotice'"}],attrs:{type:"textarea","ext-cls":"bk-remindway-form",rows:e.customRow||22},model:{value:e.formInfo.message,callback:function(t){e.$set(e.formInfo,"message",t)},expression:"formInfo.message"}}),e._v(" "),t("div",{staticClass:"bk-select-btn"},[t("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:e.$t("m.slaContent['插入变量']"),icon:"plus"}},[e._v("\n            "+e._s(e.$t('m.slaContent["插入变量"]'))+"\n          ")]),e._v(" "),t("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(t){return e.changeInsert(...arguments,"message")}},model:{value:e.insertVariable.id,callback:function(t){e.$set(e.insertVariable,"id",t)},expression:"insertVariable.id"}},e._l(e.variableList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1)],1)]:"SMS"===e.checkId?[e.isShowTitle?t("bk-form-item",{attrs:{label:e.$t("m.slaContent['标题']"),required:!0,property:"title","icon-offset":240}},[t("bk-input",{attrs:{type:"text","ext-cls":"bk-remindway-form"},model:{value:e.formInfo.title,callback:function(t){e.$set(e.formInfo,"title",t)},expression:"formInfo.title"}}),e._v(" "),t("div",{staticClass:"bk-select-btn"},[t("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:e.$t("m.slaContent['插入变量']"),icon:"plus"}},[e._v("\n            "+e._s(e.$t('m.slaContent["插入变量"]'))+"\n          ")]),e._v(" "),t("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(t){return e.changeInsert(...arguments,"title")}},model:{value:e.insertVariable.titleId,callback:function(t){e.$set(e.insertVariable,"titleId",t)},expression:"insertVariable.titleId"}},e._l(e.variableList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1)],1):e._e(),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.slaContent['短信内容']"),required:!0,property:"message","icon-offset":240}},[t("bk-input",{directives:[{name:"cursorIndex",rawName:"v-cursorIndex",value:"editorNotice",expression:"'editorNotice'"}],attrs:{type:"textarea","ext-cls":"bk-remindway-form",rows:e.customRow||15},model:{value:e.formInfo.message,callback:function(t){e.$set(e.formInfo,"message",t)},expression:"formInfo.message"}}),e._v(" "),t("div",{staticClass:"bk-select-btn"},[t("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:e.$t("m.slaContent['插入变量']"),icon:"plus"}},[e._v("\n            "+e._s(e.$t('m.slaContent["插入变量"]'))+"\n          ")]),e._v(" "),t("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(t){return e.changeInsert(...arguments,"message")}},model:{value:e.insertVariable.id,callback:function(t){e.$set(e.insertVariable,"id",t)},expression:"insertVariable.id"}},e._l(e.variableList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1)],1)]:[e.isShowTitle?t("bk-form-item",{attrs:{label:e.$t("m.slaContent['标题']"),required:!0,property:"title","icon-offset":240}},[t("bk-input",{attrs:{type:"text","ext-cls":"bk-remindway-form"},model:{value:e.formInfo.title,callback:function(t){e.$set(e.formInfo,"title",t)},expression:"formInfo.title"}}),e._v(" "),t("div",{staticClass:"bk-select-btn"},[t("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:e.$t("m.slaContent['插入变量']"),icon:"plus"}},[e._v("\n            "+e._s(e.$t('m.slaContent["插入变量"]'))+"\n          ")]),e._v(" "),t("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(t){return e.changeInsert(...arguments,"title")}},model:{value:e.insertVariable.titleId,callback:function(t){e.$set(e.insertVariable,"titleId",t)},expression:"insertVariable.titleId"}},e._l(e.variableList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1)],1):e._e(),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m['内容']"),required:!0,property:"message","icon-offset":240}},[t("bk-input",{directives:[{name:"cursorIndex",rawName:"v-cursorIndex",value:"editorNotice",expression:"'editorNotice'"}],attrs:{type:"textarea","ext-cls":"bk-remindway-form",rows:e.customRow||15},model:{value:e.formInfo.message,callback:function(t){e.$set(e.formInfo,"message",t)},expression:"formInfo.message"}}),e._v(" "),t("div",{staticClass:"bk-select-btn"},[t("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:e.$t("m.slaContent['插入变量']"),icon:"plus"}},[e._v("\n            "+e._s(e.$t('m.slaContent["插入变量"]'))+"\n          ")]),e._v(" "),t("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(t){return e.changeInsert(...arguments,"message")}},model:{value:e.insertVariable.id,callback:function(t){e.$set(e.insertVariable,"id",t)},expression:"insertVariable.id"}},e._l(e.variableList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1)],1)]],2),e._v(" "),e.isShowFooter?t("div",{staticClass:"bk-add-btn"},[t("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!e.hasPermission(["ticket_state_manage"])},expression:"{ active: !hasPermission(['ticket_state_manage']) }"}],class:{"btn-permission-disable":!e.hasPermission(["ticket_state_manage"])},attrs:{theme:"primary",title:e.$t("m.serviceConfig['确认']"),loading:e.secondClick},on:{click:e.submitNotice}},[e._v("\n      "+e._s(e.$t('m.serviceConfig["确认"]'))+"\n    ")]),e._v(" "),t("bk-button",{attrs:{theme:"default",title:e.$t("m.serviceConfig['取消']"),loading:e.secondClick},on:{click:e.closeNotice}},[e._v("\n      "+e._s(e.$t('m.serviceConfig["取消"]'))+"\n    ")])],1):e._e()],1)},i=[];n._withStripped=!0}}]);